# HTTP/1.0
## シンプルなフォーム送信: `xml.go`
- キーと値が`=`で繋がれる
- xml形式のデータは`Content-Type: x-www-form-urlencoded`を使うことで，エンコードされた情報が送信される
- スペースや=, &といった文字は[変換フォーマット](https://url.spec.whatwg.org/#application/x-www-form-urlencoded)に従い，URLエンコードされる






## フォームを使ったファイル送信: `multipart-form.go`
- ファイル送信には`multipart/form-data`を使う
- フィールド名，ファイル名，ファイルタイプ，ファイルの中身を全て送れる
```
$ curl --http1.0 -F attachment-file=@http1.txt http://localhost:8080/upload

// ファイル名変更できる
$ curl --http1.0 -F "attachment-file=@http1.txt;filename=changed-http1.txt" http://localhost:8080/upload
```
> [!TIP]
> http://localhost:8080 にアクセスしてファイルアップロードしてもOK!

- x-www-form-urlencodedは1つの情報しか送信できないため使い分ける必要がある!

### フォーム送信時のレスポンス
- フォームをPOSTで送信したらサーバがその情報を処理して返す
- ユーザは送信を行ったらページが表示されることを期待する
- しかし，POSTだと正しく表示できない可能性がある
- さらに，リロードしようとするとダイアログを表示させてしまう

> [!NOTE]
> POST用のURLと表示用のURLは分けるべき！
> サーバは一旦，302 Foundステータスを返して結果表示画面へ遷移させるのがいい！





# その他TIPs
## 圧縮による転送速度向上
- コンテンツを圧縮することでテキストファイルなら1/10程度，JSONであれば最大1/20程度まで高速化できる！
- 通信よりも圧縮・展開の時間は短いため表示速度が向上する！

### やり方
1. クライアントが受け入れ可能な圧縮方式をヘッダで指定
2. サーバでは，リストのうち対応するものがあれば返信時に圧縮，あるいは事前に圧縮したコンテンツを返却

### 圧縮アルゴリズム
- Googleは`gzip`よりも効率的な[`Brotli`](https://github.com/google/brotli)という圧縮フォーマットをOSSで開発し，規格化した
    - Chrome, Safari, FireFox, Edgeなどは対応している
- そのほかにも[`ZStandard`](https://github.com/facebook/zstd)というMetaが開発した圧縮アルゴリズムもある
- 読み出し回数やリアルタイム圧縮など，ユースケースに合ったものを選択すべき！





## Cookie
- DBは，クライアント→DBの管理システムへSQLを発行してデータを保存する
- Cookieは，サービス側がクライアント(ブラウザ)へトークンの保存を指示する
- `-c`でクッキーを保存して，`-b`でクッキーを送信できる
```
$ curl --http1.0 -c cookie.txt -b cookie.txt http://localhost:8080
```

### Cookieを使ったセッション管理
1. クライアントがフォームでID, passを送信 (SSL/TLS必須)
2. サーバでID, passを検証して問題なければセッショントークンを発行
3. サーバがセッショントークンをRDB or Redis等に保存
4. トークンをCookieとしてクライアントに返却
5. 2回目以降はリクエストにCookieを含めることで，ログイン済みか検証できる

### 署名付きCookieによるセッションデータ保存
- クライアント側で改竄されないように電子署名済みのデータを送る
- 署名やトークンの検証，公開鍵，秘密鍵は全てサーバで管理
    - サーバ側にデータ保存の仕組みを用意する必要がなくなる
- Cookieに一時データが保存されるが，別デバイスからのアクセスは共有されない
- 現在のCookieだけでなく過去のCoookieが漏洩してもログイン済みかのように操作を許す「リプレイ攻撃」のリスクになる





## Origin
- Aというサイトにログインした状態で，Bというサイトにアクセスした時，Aのサイトのアクセス権限が維持されているとBのサイトはAのサイトで保存された情報にアクセスし放題になってしまう
- これを防ぐため，「スキーム，ドメイン，ポート」の3つが同じであることを表す同一オリジンでなければデータにアクセスできないよう設定されている
- [same-site/cross-site, same-origin/cross-origin](https://zenn.dev/agektmr/articles/f8dcd345a88c97)の定義を要確認！


## キャッシュ
- リッチ化により必要な情報が多くなって，表示までの時間が増加傾向にある
- そこで，内容に変化がなければダウンロードを抑制し，パフォーマンスを上げるメカニズムのこと
- 詳細は`./CACHE.md`を参照！


